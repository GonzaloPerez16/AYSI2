package gnu.chu.comm;

import gnu.chu.controles.StatusBar;
import gnu.chu.utilidades.Iconos;
import gnu.chu.utilidades.ventana;
import java.awt.BorderLayout;
import java.awt.Dimension;
import java.sql.Types;
import javax.swing.SwingUtilities;
import javax.swing.Timer;


public class IFBascula extends ventana
{
    Timer temporizador; 
    leePeso peso;
    /**
     * Creates new form IFBascula
     * @param peso
     */
    public IFBascula(leePeso peso) {
        this.peso=peso;
        initComponents();
        this.setSize(new Dimension(320,180));
        this.setClosable(false);
        this.setResizable(true);
        statusBar=new StatusBar(this);
        this.add(statusBar,BorderLayout.SOUTH);
        numCajasE.setValorDec(peso.getNumeroCajas());
        pesoCajaE.setValorDec(peso.getPesoCaja());
        taraE.setValorDec(peso.getTara());
        temporizador=new Timer(3000,new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
              leePeso();
            }
        });
        temporizador.setDelay(3000);
        temporizador.start();
        setCabeceraVentana(false);
        
    }
    public void matar(boolean cerrarConexion)
    {
        temporizador.stop();
        this.setVisible(false);
    }
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        Pprinc = new gnu.chu.controles.CPanel();
        cLabel1 = new gnu.chu.controles.CLabel();
        pesoOrigE = new gnu.chu.controles.CTextField(Types.DECIMAL,"----9.999");
        BReset = new gnu.chu.controles.CButton(Iconos.getImageIcon("cancel"));
        taraE = new gnu.chu.controles.CTextField(Types.DECIMAL,"----9.999");
        cLabel2 = new gnu.chu.controles.CLabel();
        pesoFinalE = new gnu.chu.controles.CTextField(Types.DECIMAL,"----9.999");
        cLabel3 = new gnu.chu.controles.CLabel();
        numCajasE = new gnu.chu.controles.CTextField(Types.DECIMAL,"##9");
        cLabel4 = new gnu.chu.controles.CLabel();
        pesoCajaE = new gnu.chu.controles.CTextField(Types.DECIMAL,"#9.999");
        opLeer = new gnu.chu.controles.CCheckBox();
        Btara = new gnu.chu.controles.CButton(Iconos.getImageIcon("bascula"));

        Pprinc.setLayout(null);

        cLabel1.setText("Peso Final");
        cLabel1.setFont(new java.awt.Font("Dialog", 1, 14)); // NOI18N
        Pprinc.add(cLabel1);
        cLabel1.setBounds(50, 100, 100, 20);

        pesoOrigE.setEditable(false);
        Pprinc.add(pesoOrigE);
        pesoOrigE.setBounds(120, 2, 80, 20);

        BReset.setText("Reset");
        BReset.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BResetActionPerformed(evt);
            }
        });
        Pprinc.add(BReset);
        BReset.setBounds(210, 30, 90, 30);

        taraE.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                taraEFocusLost(evt);
            }
        });
        Pprinc.add(taraE);
        taraE.setBounds(120, 30, 80, 20);

        cLabel2.setText("Peso Origen");
        cLabel2.setFont(new java.awt.Font("Dialog", 1, 14)); // NOI18N
        Pprinc.add(cLabel2);
        cLabel2.setBounds(10, 2, 100, 20);

        pesoFinalE.setEditable(false);
        Pprinc.add(pesoFinalE);
        pesoFinalE.setBounds(160, 100, 80, 20);

        cLabel3.setText("Numero Cajas ");
        Pprinc.add(cLabel3);
        cLabel3.setBounds(10, 70, 90, 17);

        numCajasE.setDoubleBuffered(true);
        numCajasE.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                numCajasEFocusLost(evt);
            }
        });
        Pprinc.add(numCajasE);
        numCajasE.setBounds(100, 70, 30, 17);

        cLabel4.setText("Peso por Cajas");
        Pprinc.add(cLabel4);
        cLabel4.setBounds(150, 70, 90, 17);

        pesoCajaE.setDoubleBuffered(true);
        pesoCajaE.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                pesoCajaEFocusLost(evt);
            }
        });
        Pprinc.add(pesoCajaE);
        pesoCajaE.setBounds(250, 70, 40, 17);

        opLeer.setSelected(true);
        opLeer.setText("Leer bascula");
        opLeer.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                opLeerActionPerformed(evt);
            }
        });
        Pprinc.add(opLeer);
        opLeer.setBounds(213, 0, 90, 23);

        Btara.setText("Tara");
        Btara.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BtaraActionPerformed(evt);
            }
        });
        Pprinc.add(Btara);
        Btara.setBounds(10, 30, 90, 30);

        getContentPane().add(Pprinc, java.awt.BorderLayout.CENTER);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void BResetActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BResetActionPerformed
        leePeso();
        taraE.setValorDec(0);  
        actualPesoFinal();
    }//GEN-LAST:event_BResetActionPerformed
    void actualPesoFinal()
    {
        peso.setTara(taraE.getValorDec());
        peso.setNumeroCajas(numCajasE.getValorInt());
        peso.setPesoCajas(pesoCajaE.getValorDec());
        
        leePeso();
    }
    private void opLeerActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_opLeerActionPerformed
        actualTemporizador();
    }//GEN-LAST:event_opLeerActionPerformed
    public void actualTemporizador()
    {
        if (opLeer.isSelected())
            temporizador.start();
        else
            temporizador.stop();
    }
    private void numCajasEFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_numCajasEFocusLost
        actualPesoFinal();
    }//GEN-LAST:event_numCajasEFocusLost

    private void pesoCajaEFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_pesoCajaEFocusLost
       actualPesoFinal();
    }//GEN-LAST:event_pesoCajaEFocusLost

    private void BtaraActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BtaraActionPerformed
        taraE.setValorDec(pesoOrigE.getValorDec());  
        actualPesoFinal();
    }//GEN-LAST:event_BtaraActionPerformed

    private void taraEFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_taraEFocusLost
       
        actualPesoFinal();
    }//GEN-LAST:event_taraEFocusLost
    public  void leePeso()
    {
       SwingUtilities.invokeLater(new Thread()
          {
              @Override
              public void run() {
                   pesoOrigE.setValorDec(peso.getPeso(false));
                    pesoFinalE.setValorDec(pesoOrigE.getValorDec()-
                  peso.getPesoDescontar() );             
              }
          });
    }
    public void setNumeroCajas(int numeroCajas)
    {
        numCajasE.setValorDec(numeroCajas);
    }
    public int getNumeroCajas()
    {
        return numCajasE.getValorInt();
    }
    public void setPesoCaja(double peso)
    {
        pesoCajaE.setValorDec(peso);
    }
    public void setTara(double tara)
    {
        taraE.setValorDec(tara);
    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private gnu.chu.controles.CButton BReset;
    private gnu.chu.controles.CButton Btara;
    private gnu.chu.controles.CPanel Pprinc;
    private gnu.chu.controles.CLabel cLabel1;
    private gnu.chu.controles.CLabel cLabel2;
    private gnu.chu.controles.CLabel cLabel3;
    private gnu.chu.controles.CLabel cLabel4;
    private gnu.chu.controles.CTextField numCajasE;
    private gnu.chu.controles.CCheckBox opLeer;
    private gnu.chu.controles.CTextField pesoCajaE;
    private gnu.chu.controles.CTextField pesoFinalE;
    private gnu.chu.controles.CTextField pesoOrigE;
    private gnu.chu.controles.CTextField taraE;
    // End of variables declaration//GEN-END:variables
}
